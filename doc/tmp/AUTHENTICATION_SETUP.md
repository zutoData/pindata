# PinData ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

## åŠŸèƒ½æ¦‚è¿°

âœ… å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿå·²æˆåŠŸé›†æˆåˆ° PinData é¡¹ç›®ä¸­ï¼ŒåŒ…æ‹¬ï¼š

- **ç”¨æˆ·æ³¨å†Œå’Œç™»å½•**ï¼šå®Œæ•´çš„å‰åç«¯è®¤è¯æµç¨‹
- **é¦–ä¸ªç”¨æˆ·ç‰¹æƒ**ï¼šç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·è‡ªåŠ¨è·å¾—è¶…çº§ç®¡ç†å‘˜æƒé™
- **JWT è®¤è¯**ï¼šåŸºäºä»¤ç‰Œçš„å®‰å…¨è®¤è¯æœºåˆ¶
- **æƒé™ç®¡ç†**ï¼šè§’è‰²å’Œæƒé™æ§åˆ¶ç³»ç»Ÿ
- **ä¼šè¯ç®¡ç†**ï¼šå¤šè®¾å¤‡ç™»å½•å’Œä¼šè¯æ§åˆ¶
- **å›½é™…åŒ–æ”¯æŒ**ï¼šä¸­è‹±æ–‡ç•Œé¢

## å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–æ•°æ®åº“

```bash
cd backend
python migrations/create_user_management_tables.py
```

### 2. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
python run.py
```

### 3. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd frontend
npm run dev
```

### 4. é¦–æ¬¡è®¿é—®

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5173`
2. ç³»ç»Ÿä¼šè‡ªåŠ¨è·³è½¬åˆ°æ³¨å†Œé¡µé¢
3. æ³¨å†Œç¬¬ä¸€ä¸ªç”¨æˆ·ï¼ˆè‡ªåŠ¨è·å¾—ç®¡ç†å‘˜æƒé™ï¼‰
4. ç³»ç»Ÿä¼šè‡ªåŠ¨ç™»å½•å¹¶è·³è½¬åˆ°ä¸»ç•Œé¢

## ç³»ç»Ÿç‰¹æ€§

### ğŸ” è®¤è¯åŠŸèƒ½

- **æ³¨å†Œ/ç™»å½•**ï¼šç”¨æˆ·å/é‚®ç®± + å¯†ç 
- **è®°ä½ç™»å½•**ï¼šæŒä¹…åŒ–ç™»å½•çŠ¶æ€
- **è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°**ï¼šæ— æ„ŸçŸ¥çš„ä»¤ç‰Œæ›´æ–°
- **å¤šè®¾å¤‡æ”¯æŒ**ï¼šè·¨è®¾å¤‡ä¼šè¯ç®¡ç†

### ğŸ‘‘ é¦–ä¸ªç”¨æˆ·ç‰¹æƒ

- ç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·è‡ªåŠ¨è·å¾— `super_admin` è§’è‰²
- æ‹¥æœ‰æ‰€æœ‰ç³»ç»Ÿæƒé™
- è‡ªåŠ¨åŠ å…¥é»˜è®¤ç»„ç»‡
- æ³¨å†ŒæˆåŠŸåç›´æ¥ç™»å½•

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

- å¯†ç å“ˆå¸Œå­˜å‚¨ï¼ˆWerkzeug PBKDF2ï¼‰
- JWT ä»¤ç‰Œè®¤è¯
- ä¼šè¯ç®¡ç†å’Œè®¾å¤‡è·Ÿè¸ª
- æ“ä½œå®¡è®¡æ—¥å¿—
- è‡ªåŠ¨ç™»å‡ºæœºåˆ¶

### ğŸ¯ æƒé™ç³»ç»Ÿ

**å†…ç½®è§’è‰²ï¼š**
- `super_admin`ï¼šè¶…çº§ç®¡ç†å‘˜
- `admin`ï¼šç³»ç»Ÿç®¡ç†å‘˜
- `data_admin`ï¼šæ•°æ®ç®¡ç†å‘˜
- `user`ï¼šæ™®é€šç”¨æˆ·
- `viewer`ï¼šåªè¯»ç”¨æˆ·

**æƒé™ç±»å‹ï¼š**
- ç³»ç»Ÿçº§æƒé™ï¼ˆé€šè¿‡è§’è‰²ï¼‰
- èµ„æºçº§æƒé™ï¼ˆowner/admin/write/readï¼‰
- ç»„ç»‡çº§æƒé™éš”ç¦»

## API ç«¯ç‚¹

### è®¤è¯ç›¸å…³
- `POST /api/v1/login` - ç”¨æˆ·ç™»å½•
- `POST /api/v1/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/logout` - ç”¨æˆ·ç™»å‡º
- `POST /api/v1/refresh` - åˆ·æ–°ä»¤ç‰Œ
- `GET /api/v1/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `PUT /api/v1/me` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `POST /api/v1/change-password` - ä¿®æ”¹å¯†ç 

### ç”¨æˆ·ç®¡ç†ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
- `GET /api/v1/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/v1/users` - åˆ›å»ºç”¨æˆ·
- `GET /api/v1/users/{id}` - è·å–ç”¨æˆ·è¯¦æƒ…
- `PUT /api/v1/users/{id}` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/v1/users/{id}` - åˆ é™¤ç”¨æˆ·

## å‰ç«¯ç»„ä»¶

### é¡µé¢ç»„ä»¶
- `Login.tsx` - ç™»å½•é¡µé¢
- `Register.tsx` - æ³¨å†Œé¡µé¢

### è®¤è¯ç»„ä»¶
- `ProtectedRoute.tsx` - è·¯ç”±å®ˆå«
- `PermissionGuard.tsx` - æƒé™å®ˆå«
- `AuthProvider.tsx` - è®¤è¯ä¸Šä¸‹æ–‡

### çŠ¶æ€ç®¡ç†
- `authStore.ts` - ç”¨æˆ·è®¤è¯çŠ¶æ€ç®¡ç†
- `auth.service.ts` - è®¤è¯ç›¸å…³ API æœåŠ¡

## ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯æƒé™æ£€æŸ¥

```tsx
import { PermissionGuard } from '../components/auth';

// æƒé™å®ˆå«ç»„ä»¶
<PermissionGuard permissions={['dataset.create']}>
  <CreateDatasetButton />
</PermissionGuard>

// Hook æ–¹å¼
const { hasPermission } = useAuthStore();
if (hasPermission('user.manage')) {
  // æ˜¾ç¤ºç”¨æˆ·ç®¡ç†åŠŸèƒ½
}
```

### å—ä¿æŠ¤çš„è·¯ç”±

```tsx
<Route path="/admin" element={
  <ProtectedRoute requiredPermissions={['system.manage']}>
    <AdminPanel />
  </ProtectedRoute>
} />
```

### API è¯·æ±‚è®¤è¯

```typescript
// è‡ªåŠ¨æ·»åŠ è®¤è¯å¤´
const response = await authService.getCurrentUser();

// æ‰‹åŠ¨æƒé™æ£€æŸ¥
if (authStore.hasPermission('dataset.delete')) {
  await deleteDataset(id);
}
```

## æ•°æ®åº“ç»“æ„

### æ ¸å¿ƒè¡¨
- `users` - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- `roles` - è§’è‰²å®šä¹‰
- `permissions` - æƒé™å®šä¹‰
- `organizations` - ç»„ç»‡æ¶æ„

### å…³ç³»è¡¨
- `user_roles` - ç”¨æˆ·è§’è‰²åˆ†é…
- `role_permissions` - è§’è‰²æƒé™åˆ†é…
- `user_organizations` - ç”¨æˆ·ç»„ç»‡å…³ç³»
- `resource_permissions` - èµ„æºçº§æƒé™

### ç®¡ç†è¡¨
- `user_sessions` - ç”¨æˆ·ä¼šè¯
- `audit_logs` - æ“ä½œå®¡è®¡

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```env
SECRET_KEY=your-secret-key-here
JWT_SECRET_KEY=your-jwt-secret-key
DATABASE_URL=postgresql://user:pass@localhost/pindata
```

### é»˜è®¤é…ç½®
- Access Token è¿‡æœŸæ—¶é—´ï¼š24å°æ—¶
- Refresh Token è¿‡æœŸæ—¶é—´ï¼š30å¤©
- è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼š5åˆ†é’Ÿ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•æ³¨å†Œç”¨æˆ·**
   - æ£€æŸ¥æ•°æ®åº“è¿æ¥
   - ç¡®è®¤ç”¨æˆ·ç®¡ç†è¡¨å·²åˆ›å»º
   - æŸ¥çœ‹åç«¯æ—¥å¿—

2. **ç™»å½•åç«‹å³ç™»å‡º**
   - æ£€æŸ¥ JWT å¯†é’¥é…ç½®
   - ç¡®è®¤æ—¶é—´åŒæ­¥
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

3. **æƒé™æ£€æŸ¥å¤±è´¥**
   - ç¡®è®¤ç”¨æˆ·è§’è‰²åˆ†é…
   - æ£€æŸ¥æƒé™é…ç½®
   - æŸ¥çœ‹å®¡è®¡æ—¥å¿—

### é‡ç½®ç³»ç»Ÿ
```bash
# é‡ç½®æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
cd backend
python migrations/create_user_management_tables.py drop
python migrations/create_user_management_tables.py create
```

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°æƒé™
1. åœ¨ `migrations/init_user_permissions.sql` ä¸­æ·»åŠ æƒé™
2. æ›´æ–°ç›¸å…³è§’è‰²åˆ†é…
3. åœ¨å‰ç«¯æ·»åŠ æƒé™æ£€æŸ¥

### è‡ªå®šä¹‰è§’è‰²
1. ä½¿ç”¨ç®¡ç†å‘˜è´¦å·åˆ›å»ºæ–°è§’è‰²
2. åˆ†é…ç›¸åº”æƒé™
3. ä¸ºç”¨æˆ·åˆ†é…æ–°è§’è‰²

### é›†æˆç°æœ‰æ¨¡å—
```python
# åç«¯ API ä¿æŠ¤
@login_required
@permission_required('dataset.create')
def create_dataset():
    pass
```

```tsx
// å‰ç«¯ç»„ä»¶ä¿æŠ¤
<PermissionGuard permissions={['dataset.manage']}>
  <DatasetManagement />
</PermissionGuard>
```

## å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼š
   - ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
   - å¯ç”¨ HTTPS
   - é…ç½®å®‰å…¨çš„ JWT å¯†é’¥
   - è®¾ç½®åˆç†çš„ä¼šè¯è¿‡æœŸæ—¶é—´

2. **æƒé™ç®¡ç†**ï¼š
   - éµå¾ªæœ€å°æƒé™åŸåˆ™
   - å®šæœŸå®¡æŸ¥ç”¨æˆ·æƒé™
   - ç›‘æ§æ“ä½œå®¡è®¡æ—¥å¿—

3. **å¤‡ä»½ç­–ç•¥**ï¼š
   - å®šæœŸå¤‡ä»½ç”¨æˆ·æ•°æ®
   - ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯

---

ğŸ‰ è®¤è¯ç³»ç»Ÿå·²æˆåŠŸé›†æˆï¼ç°åœ¨ä½ å¯ä»¥å®‰å…¨åœ°ç®¡ç†ç”¨æˆ·è®¿é—®å’Œæƒé™æ§åˆ¶äº†ã€‚




